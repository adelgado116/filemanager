<?phprequire_once('functions_hssiso.php');include('dbConnect_hssiso.inc');if (! @mysql_select_db('hss_db', $link_id) ) {	die( '<p>Unable to locate the database at this time. E1</p>' );}// check that all POST variables have been setif(!isset($_POST['method']) || !$method = $_POST['method']) exit;if(!isset($_POST['oldValue']) || !$oldValue = $_POST['oldValue']) exit;if(!isset($_POST['newValue']) || !$newValue = strtoupper( $_POST['newValue'] ) ) exit;if(!isset($_POST['target']) || !$target = $_POST['target']) exit;$passed = false;$retval = '';switch($method) {	case 'rename':				$sql = "SELECT * FROM report_starter WHERE serviceOrder = '$newValue'";				$res1 = mysql_query($sql) or die('Query failed [check for existing service order]: ' . mysql_error());				if ( mysql_num_rows($res1) != 1 ) {						$sql = "					SELECT service_tbl.IMO_NUMBER, service_tbl.REQUISNUMBER, ships_tbl.SHIP_NAME, ports_tbl.PORT_NAME, agents_tbl.AGENT_NAME,							equipment_model_tbl.EQUIP_MODEL, equipment_manufacturer_tbl.MANUF_NAME, equipment_type_tbl.EQUIP_TYPE, service_items_tbl.REQUEST,							service_type_tbl.SERVICE_TYPE					FROM service_tbl, ships_tbl, ports_tbl, agents_tbl, service_items_tbl, equipment_model_tbl,						 equipment_manufacturer_tbl, equipment_type_tbl, service_type_tbl					WHERE service_tbl.ORDER_NO = '$newValue'					AND ships_tbl.IMO_NUMBER = service_tbl.IMO_NUMBER					AND ports_tbl.PORT_ID = service_tbl.PORT_ID					AND agents_tbl.AGENT_ID = service_tbl.AGENT_ID					AND service_items_tbl.ORDER_NO = service_tbl.ORDER_NO					AND equipment_model_tbl.EQUIP_ID = service_items_tbl.EQUIP_ID					AND equipment_manufacturer_tbl.MANUF_ID = equipment_model_tbl.MANUF_ID					AND equipment_type_tbl.EQUIP_TYPE_ID = equipment_model_tbl.EQUIP_TYPE_ID					AND service_type_tbl.SERVICE_TYPE_ID = service_items_tbl.SERVICE_TYPE_ID					";						$result0 = mysql_query($sql) or die('Query failed [getting particulars]: ' . mysql_error());						$table_row = array();			$table_row = get_table($result0);									$vessel = $table_row[0]['SHIP_NAME'];			$imo = $table_row[0]['IMO_NUMBER'];			$place = $table_row[0]['PORT_NAME'];			$agent = $table_row[0]['AGENT_NAME'];			$customerOrder = $table_row[0]['REQUISNUMBER'];			$typeOfService = $table_row[0]['SERVICE_TYPE'];			$equipment = $table_row[0]['MANUF_NAME'].' - '.$table_row[0]['EQUIP_TYPE'].' - '.$table_row[0]['EQUIP_MODEL'];			$request = $table_row[0]['REQUEST'];						# update possible changes for this order in report_starter  -- (changes made to the worksheet)			$sql = "UPDATE report_starter					SET serviceOrder = '$newValue', vesselName = '$vessel', imo = '$imo', place = '$place', agent = '$agent',						customerOrder = '$customerOrder', typeOfService = '$typeOfService', equipment = '$equipment', serviceRequest = '$request'						WHERE serviceOrder = '$oldValue'";			$result05 = mysql_query($sql) or die('Query failed [changing service order report]: ' . mysql_error());									$retval = 'Order No. updated successfully';			$passed = true;					} else {						$retval = "Order No. already exists and cannot be duplicated";			$passed = false;		}			break;			case 'clearMessage':				$retval = '';		$passed = false;		break;			default:		exit;		break;}include "./class.xmlresponse.php";$xml = new xmlResponse();$xml->start();$xml->command('setcontent', array('target' => "$target", 'content' => $retval ) );if($passed) { 	// set the message colour to green and the checkbox to checked	$xml->command('setstyle', array('target' => "$target", 'property' => 'color', 'value' => 'green') );} else {		// set the message colour to red, the checkbox to unchecked and focus back on the field	$xml->command('setstyle', array('target' => "$target", 'property' => 'color', 'value' => 'red') );}$xml->end();?>