<?php##  connect to database#include('dbConnect_hssiso.inc');if (! @mysql_select_db('hss_db', $link_id) ) {	die( '<p>Unable to locate the database at this time. E1</p>' );}// check that all POST variables have been setif(!isset($_POST['method']) || !$method = $_POST['method']) exit;if(!isset($_POST['value']) || !$value = strtoupper( $_POST['value'] ) ) exit;if(!isset($_POST['target']) || !$target = $_POST['target']) exit;$passed = false;$retval = '';switch($method) {	case 'checkOrderNo':				$sql = "SELECT service_tbl.IMO_NUMBER, service_tbl.REQUISNUMBER, ships_tbl.SHIP_NAME, ports_tbl.PORT_NAME, agents_tbl.AGENT_NAME,					equipment_model_tbl.EQUIP_MODEL, equipment_manufacturer_tbl.MANUF_NAME, equipment_type_tbl.EQUIP_TYPE, service_items_tbl.REQUEST,					service_type_tbl.SERVICE_TYPE			FROM service_tbl, ships_tbl, ports_tbl, agents_tbl, service_items_tbl, equipment_model_tbl, equipment_manufacturer_tbl, equipment_type_tbl,				 service_type_tbl			WHERE service_tbl.ORDER_NO = '$value'			AND ships_tbl.IMO_NUMBER = service_tbl.IMO_NUMBER			AND ports_tbl.PORT_ID = service_tbl.PORT_ID			AND agents_tbl.AGENT_ID = service_tbl.AGENT_ID			AND service_items_tbl.ORDER_NO = service_tbl.ORDER_NO			AND equipment_model_tbl.EQUIP_ID = service_items_tbl.EQUIP_ID			AND equipment_manufacturer_tbl.MANUF_ID = equipment_model_tbl.MANUF_ID			AND equipment_type_tbl.EQUIP_TYPE_ID = equipment_model_tbl.EQUIP_TYPE_ID			AND service_type_tbl.SERVICE_TYPE_ID = service_items_tbl.SERVICE_TYPE_ID ";						$res1 = mysql_query($sql) or die('Query failed [check for existing service order]: ' . mysql_error());		if ( mysql_num_rows($res1) >= 1 ) {   // modified on 07.04.2014 to let user create parts lists for Service Orders with more than 1 equip. 						$row1 = mysql_fetch_array($res1, MYSQL_ASSOC);						$retval = 'This Service Order exists in ODIN.<br/>Press "continue" button to<br/>Create/Edit the Spare Parts list.';			$passed = true;					} else {						$retval = "This Service Order does not exist in ODIN.<br/>Press \"continue\" button to use<br/>temporary Code <strong>$value</strong>.";			$passed = false;		}			break;			case 'clearMessage':				$retval = '';		$passed = false;		break;			default:		exit;		break;}include "./class.xmlresponse.php";$xml = new xmlResponse();$xml->start();// set the response text$vessel = $row1['SHIP_NAME'];$imo = $row1['IMO_NUMBER'];$place = $row1['PORT_NAME'];$agent = $row1['AGENT_NAME'];$customerOrder = $row1['REQUISNUMBER'];$typeOfService = $row1['SERVICE_TYPE'];$equipment = $row1['MANUF_NAME'].' - '.$row1['EQUIP_TYPE'].' - '.$row1['EQUIP_MODEL'];//$xml->command('setcontent', array('target' => "rsp_$target", 'content' => htmlentities( $retval ) ) );$xml->command('setcontent', array('target' => "rsp_$target", 'content' => $retval ) );if($passed) { 	// set the message colour to green and the checkbox to checked	$xml->command('setstyle', array('target' => "rsp_$target", 'property' => 'color', 'value' => 'green') );	$xml->command('setstyle', array('target' => "serviceOrder", 'property' => 'background', 'value' => 'green') );	$xml->command('setstyle', array('target' => "serviceOrder", 'property' => 'color', 'value' => 'white') );		$xml->command( 'setvalue', array('target' => "vesselName", 'value' => "$vessel" ) );	$xml->command( 'setvalue', array('target' => "imo", 'value' => "$imo" ) );	$xml->command( 'setvalue', array('target' => "place", 'value' => "$place" ) );	$xml->command( 'setvalue', array('target' => "agent", 'value' => "$agent" ) );	$xml->command( 'setvalue', array('target' => "customerOrder", 'value' => "$customerOrder" ) );	$xml->command( 'setvalue', array('target' => "typeOfService", 'value' => "$typeOfService" ) );	$xml->command( 'setvalue', array('target' => "equipment", 'value' => "$equipment" ) );	} else {		// set the message colour to red, the checkbox to unchecked and focus back on the field	$xml->command('setstyle', array('target' => "rsp_$target", 'property' => 'color', 'value' => 'red') );	$xml->command('setstyle', array('target' => "serviceOrder", 'property' => 'background', 'value' => 'white') );	$xml->command('setstyle', array('target' => "serviceOrder", 'property' => 'color', 'value' => 'black') );		$xml->command( 'setdefault', array('target' => "vesselName") );	$xml->command( 'setdefault', array('target' => "imo") );	$xml->command( 'setdefault', array('target' => "place") );	$xml->command( 'setdefault', array('target' => "agent") );	$xml->command( 'setdefault', array('target' => "customerOrder") );	$xml->command( 'setdefault', array('target' => "typeOfService") );	$xml->command( 'setdefault', array('target' => "equipment") );	}$xml->end();?>